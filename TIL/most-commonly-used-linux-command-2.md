# 가장 많이 쓰는 리눅스 명령어(2) - find
사용자가 지정한 기준에 따라 파일을 찾고, 사용자가 정의한 행위에 매칭되는 파일을 시스템 디렉터리 트리에서 # 검색하여 파일을 찾아주는 command line utility
## 1. 사용법 알아보기
### 1.1. 기본 사용법(1)
파일을 찾고자 하는 대상 경로, 어떤 기준으로 어떤 파일을 찾을지에 대한 표현식으로 이루어짐
- 대상 경로는 기본적으로 현재 디렉토리를 가리킴
```bash
$ find [대상 경로] [표현식]
```
```bash
$ find workspace -name regex.txt
workspace/shell-basic/chapter02/regex.txt
workspace/shell-basic/chapter01/regular-expression/regex.txt
```
### 1.2. 기본 사용법(2)
대상 경로 앞에 옵션 두고 사용하기
```bash
$ find [옵션] [대상 경로] [표현식]
```
```bash
# 파일 권한이 644(소유자 - 읽기/쓰기, 그룹 - 읽기, 기타 - 읽기)를 가진 파일을 검색하라
find -L /etc -perm 644 -name 'rc.*'
/etc/rc.common
/etc/rc.netboot
find: /etc/cups/certs: Permission denied
```
## 2. find의 다양한 표현식
find는 사용자가 필요로 하는 조건으로 파일을 찾기 위한 방법을 옵션이 아닌 `표현식`으로 제공
- 테스트: find에서 찾고자 하는 파일의 속성을 정의
- 연산자: 테스트의 검색 우선순위를 정의
- 액션: 검색한 파일을 인수로 하여 또다른 명령어를 실행할 수 있음
- 위치 옵션: 테스트와 함께 쓰이면서 테스트의 검색조건을 변경할 수 있음

### 2.1. 테스트
find에 가장 많이 사용되는 표현식
#### 2.1.1. 시간 관련 테스트
파일이 언제 생성되었고, 언제 사용되었으며, 언제 변경되었는지를 현재 시각을 기준으로 명시된 분 또는 시간에 해당하는 파일을 찾아줌
|테스트|설명|
|--|--|
|-amin n|현재 시각을 기준으로 n분 전에 액세스된 파일을 찾아줌|
|-atime n|현재 시각을 기준으로 n*24시간 전에 액세스된 파일을 찾아줌|
|-cmin n|현재 시각을 기준으로 n분 전에 이름이 변경된 파일을 찾아줌|
|-ctime n|현재 시각을 기준으로 n*24시간 전에 이름이 변경된 파일을 찾아줌|
|-mmin n|현재 시각을 기준으로 n분 전에 내용이 수정된 파일을 찾아줌|
|-mtime n|현재 시각을 기준으로 n*24시간 전에 내용이 수정된 파일을 찾아줌|
#### 2.1.2. 최신 파일 검색 관련 테스트
명시한 파일을 기준으로 더 최근에 접근하고, 수정 및 변경이 이루어진 파일 검색
|테스트|설명|
|--|--|
|-anewer file|명시된 파일보다 최근에 접근한(Access) 파일을 찾음|
|-cnewer file|명시된 파일보다 최근에 변경된(Change) 파일을 찾음|
|-newer file|명시된 파일보다 최근에 수정된(Modify) 파일을 찾음|
|-newerXY file|명시된 파일의 속성보다 최근에 수정된 파일을 찾아줌. 파일 속성은 XY로 표시<br/>a: 파일 참조의 액세스 시간<br/>B: 파일 참조의 탄생 시간<br/>c: inode 상태 변경 시간 참조<br/>m: 파일 참조의 수정 시간|

> 변경과 수정의 차이<br/>
파일 내용이 바뀌면 변경과 수정은 동시에 일어남. 그러나, 내용 변동이 없이 파일명만 바뀌면 변경은 일어나도 수정은 일어나지 않음
#### 2.1.3. 파일 권한 관련 테스트
찾고자 하는 파일 권한에 해당하는 파일을 검색할 수 있도록 도와줌
|테스트|설명|
|--|--|
|-perm mode|명시된 파일 권한과 동일한 파일을 검색함|
|-perm -mode|명시된 파일 권한이 포함된 파일을 검색함|
|-perm /mode|명시된 파일 권한을 소유자, 그룹, 기타로 구분하여 세 개의 권한 중 하나라도 동일한 파일을 검색함|
|-readable|로그인한 사용자가 읽을 수 있는 파일 검색|
|-writable|로그인한 사용자가 쓸 수 있는 파일 검색|
|-executable|실행 권한이 있는 파일만 검색|
> 파일 소유 변경: sudo chown, 파일 권한 변경: sudo chmod
#### 2.1.4. 그룹 및 사용자 관련 테스트
|테스트|설명|
|--|--|
|-gid n|그룹ID가 명시한 그룹ID n과 동일한 파일 검색|
|-group gname|그룹명이 명시한 그룹명 gname과 동일한 파일 검색|
|-nogroup|존재하지 않는 그룹ID를 가지고 있는 파일 검색|
|-uid n|사용자ID가 명시한 사용자ID n과 동일한 파일 검색|
|-user uname|사용자명이 명시한 사용자명 uname과 동일한 파일 검색
#### 2.1.5. 파일명 관련 테스트
|테스트|설명|
|--|--|
|-iname pattern|대소문자 구분없이 패턴과 일치하는 파일 검색|
|-inum n|파일의 inode 번호 n을 갖는 파일 검색|
|-lname pattern|패턴과 일치하는 심볼릭 링크 검색|
|-name pattern|패턴과 일치하는 파일 검색|
|-regex pattern|패턴과 일치하는 경로 검색. Emacs 정규 표현식이 기본값
#### 2.1.6. 파일 경로 관련 테스트
|테스트|설명|
|--|--|
|-ipath pattern|대소문자를 구분하지 않고 패턴과 일치하는 경로를 검색함|
|-iwholename pattern|-ipath 테스트와 동일하며, -ipath 테스트보다 이식성이 떨어짐|
|-links n|N개의 링크를 가지고 있는 경로를 검색함|
|-path pattern|패턴과 일치하는 경로를 검색함|
|-wholename pattern|-path 테스트와 동일하며, -path 테스트보다 이식성이 떨어짐|
#### 2.1.7. 파일 타입 관련 테스트
검색 기준이 파일 타입일 경우 사용할 수 있는 테스트
|테스트|설명|
|--|--|
|-type 검색할타입|명시한 타입 파일과 동일한 파일을 검색|
|-xtype 검색할타입|-type 테스트와 동일하며 심볼릭 링크를 검색할 경우 -L 옵션과 함께 사용|
|-context pattern|패턴과 일치하는 보안 컨텍스트를 가진 파일을 검색함<br/>SELinux가 있는 Fedora 계열 리눅스에서만 사용 가능|

### 2.2. 연산자
|연산자|설명|
|--|--|
|( expr )|우선순위나 표현식을 그룹핑할 경우 사용되며 백슬래시(`\`)와 함께 사용해야 함|
|!expr|표현식의 반대 결과를 리턴함|
|-not expr|!expr과 같이 반대 결과를 리턴함|
|expr1 expr2|AND연산 수행, expr1이 false이면 expr2는 평가되지 않음<br>expr1 -a expr2와 같음|
|expr1 -and expr2|expr1 expr2와 동일하지만 POSIX 호환은 안 됨|
|expr1 -o expr2|OR연산 수행, expr1이 true면 expr2는 평가되지 않음|
|expr1 -or expr2|expr1 -o expr2와 동일하지만 POSIX 호환은 안 됨|
|expr1, expr2|expr1, expr2는 각각 수행되며, expr2에 해당하는 결과만 출력됨<br/>함께 출력하기 위해서는 -printf나 -fprintf를 함께 사용해야 함|
### 2.3. 액션
- 명령어 실행 관련 액션: 테스트와 같은 표현식을 통해 검색된 파일을 인자로 하여 또 다른 명령어를 실행
- 결과 출력 관련 액션: 검색 결과를 사용자의 입맛에 맞게 출력해줌
#### 2.3.1. 명령어 실행 관련 액션
|액션|설명|
|--|--|
|-delete|표현식에 의해 검색된 파일을 삭제함|
|-exec command {};|표현식에 의해 검색된 파일을 인수로 받아 -exec 다음의 명령어를 수행함.<br/>인수로 받을 결과값은 중괄호{}로 표현되며 세미콜론;은 역슬래시\와 함께 사용해야 함|
|-exec command {}+|-exec와 동일하나 결과값을 연이어서 보여줌|
|-execdir command {};|-exec와 유사하나 서브 디렉터리부터 검색하기 때문에 결과값은 파일만 출력됨|
|-execdir command {}+|-execdir과 동일하나 결과값을 연이어서 보여줌|
|-ok command {};|-exec와 유사하지만 사용자에게 실행 여부를 확인 후 실행함|
|-okdir command {};|-execdir과 유사하지만 -ok와 같은 방식으로 사용자에게 실행 여부를 확인 후 실행함|
|-prune|검색한 패턴이 디렉터리인 경우, 하위 디렉터리의 파일은 검색하지 않음|
|-quit|-quit 앞에 만난 표현식에 해당하는 파일이 검색되면 검색을 종료

#### 2.3.2. 결과 출력 관련 액션
|액션|설명|
|--|--|
|-fls file|표현식에 의해 검색된 파일의 결과를 명시한 파일로 ls -l을 실행한 것과 유사한 결과를 저장함|
|-fprint file|표현식에 의해 검색된 파일의 결과를 명시한 파일에 저장함|
|-fprint0 file|표현식에 의해 검색된 파일의 결과를 명시한 파일에 뉴라인이나 공백없이 저장함|
|-printf format|역슬래시 \와 퍼센트%로 된 표준 출력 포맷에 맞게 검색된 파일 결과를 보여줌|
|-fprintf file format|-printf와 비슷하지만 -fprint와 같이 검색된 파일을 명시한 파일에 저장함|
|-ls|표현식에 의해 검색된 파일의 결과를 ls -l을 실행한 것과 유사한 결과로 보여줌|
|-print;|표현식에 의해 검색된 파이르이 결과를 보여줌|
|-print0|표현식에 의해 검색된 파일의 결과를 뉴라인 없이 보여줌|

### 2.4. 위치 옵션
테스트 수행 시 테스트에 영향을 주기 때문에 명확성을 위해 표현의 시작 부분에 배치하는 것이 가장 좋음
|위치옵션|설명|
|--|--|
|-d|FreeBSD, NetBSD, MacOS X 및 OpenBSD와의 호환성을 위한 -depth의 동의어|
|-depth|서브 디렉터리의 파일을 먼저 검색함|
|-daystart|24시간이 아닌 해당일을 기준으로 파일 검색<br/>-amin, -atime, -cmin, -ctime, -mmin, -mtime과 함께 사용해야 함|
|-regextype type|-regex나 -iregex의 정규식 구문을 변경함<br/>기본 유형은 emacs이며, posix-awk, posix-basic, -posix-egrep, posix-extended가 있음|
|-maxdepth levels|명시한 level만큼 서브 디렉터리의 파일까지 검색함|
|-mindepth levels|명시한 level의 서브 디렉터리부터 파일을 검색함|
|-mount|USB나 CD-ROM과 같은 시스템의 파일을 검색하지 않음|
|-warn, -nowarn|경고 메시지를 켜거나 끔<br/>경고는 command line 사용법에만 적용되고 디렉터리를 검색할 때 발견되는 조건에는 적용되지 않음|
## 3. find 옵션
### 3.1. 심볼릭 링크 관련 옵션
|옵션|설명|
|--|--|
|-P|심볼릭 링크 자체의 속성을 검사하며, find의 기본 옵션|
|-L|심볼릭 링크에 연결된 파일의 속성을 검사, 검사되는 모든 파일 목록을 보여줌|
|-H|심볼릭 링크 자체의 속성을 검사하나,<br/> command line에 지정된 파일이 심볼릭 링크인 경우, 심볼릭 링크에 연결된 파일의 속성을 검사
### 3.2. 디버그 관련 옵션
find가 파일을 제대로 검색하지 못하는 이유에 대한 문제점을 진단하는 데 도움이 될 수 있음
|옵션|설명|
|--|--|
|-D help|디버깅 옵션을 설명함|
|-D tree|표현식 트리를 원래의 최적화된 형태로 보여줌|
|-D search|디렉터리 트리를 자세하게 탐색함|
|-D stat|stat나 Istat와 같은 시스템 호출이 필요한 파일을 검사할 때 메시지를 보여줌|
|-D rates|표현식이 얼마나 성공했는지를 요약해서 보여줌|
|-D opt|표현식 tree 최적화와 관련된 진단 정보를 보여줌<br/>최적화와 관련된 -O 옵션을 참조하여 사용할 수 있음|
### 3.3. 레벨 관련 옵션
쿼리 최적화 활성화 - find를 사용하여 파일을 검색할 때 사용된 전반적인 테스트의 효과를 유지하면서 실행 속도를 높이기 위해 테스트 순서 변경
|옵션|설명|
|--|--|
|-O0|최적화 수준 1과 같음|
|-O1|기본적 최적화 수준<br/>파일 이름을 기반으로 하는 테스트(e.g. -name, -regex)가 먼저 수행되도록 식 순서가 바뀜
|-O2|-type이나 -xtype과 함께 사용할 때 -name 테스트 후 -type 테스트 수행|
|-O3|전체 비용 기반 쿼리 최적화 프로그램이 활성화됨<br/>-o의 경우 성공할 수 있는 표현식이 더 빨리 평가되고 -a의 경우 실패할 수 있는 표현식이 더 빨리 평가됨