# 가장 많이 쓰는 리눅스 명령어(3) - awk
특정 인덱스 문자열을 출력할 수 있는 명령어
- 시스템 파일 목록이나 컨테이너 목록 또는 애플리케이션 실행 결과에서 특정 컬럼에 해당하는 문자열을 추출하고, 해당 결과값을 이용하여 또 다른 명령어를 실행할 때 파라미터로 사용해야 하는 경우
- 앞에서 사전에 실행된 명령어의 결과나 파일로부터 레코드를 선택하고, 선택된 레코드의 특정 인덱스에 해당하는 값을 출력할 수 있다.
- 선택된 레코드를 가지고 패턴과 일치하는지를 확인하고, 데이터 조작 및 연산 등의 액션을 수행하여 그 결과를 출력한다.
## 1. awk 사용법 알아보기
### 1.1. 기본 사용법1
옵션, 어떤 문자열을 추출할 것인지를 기술한 awk 프로그램, 그리고 대상 파일로 이루어짐
```bash
$ awk [옵션] '패턴 { 액션 }' 대상 파일
```
```bash
# Script 디렉터리 내 파일 목록을 file-list.txt에 저장
$ ls -al Script/ > file-list.txt
# 두번째 필드값이 2인 레코드의 문자열 출력
$ awk '$2 == 2 { print $NF }' file-list.txt
```
### 1.2. 기본 사용법2
필드와 레코드를 가진 표 형식의 데이터를 추출할 때 매우 유용하게 사용<br/>
awk 프로그램은 파일로 저장해두었다가 필요할 때 다음과 같이 -f 옵션과 함께 해당 파일을 로딩하여 대상 파일에서 필요로 하는 문자열을 추출할 수 있음
```bash
$ awk [옵션] -f awk_프로그램_파일 대상 파일
```
```bash
# 패턴과 액션을 awk-prog.txt 파일에 저장
$ echo '$2 == 2 { print $NF }' > awk-prog.txt
# awk-prog.txt 파일을 이용하여 디렉터리명 추출
$ awk -f awk-prog.txt file-list.txt
```
### 1.3. 기본 사용법3
리눅스 명령어나 애플리케이션의 명령어를 통해 얻은 결과를 이용해 해당 결과에서 필요한 문자열을 추출
```bash
명령어 | awk [옵션] '패턴 { 액션 }'
```
## 2. awk 프로그래밍
어떤 인덱스의 값을 추출할 것인지를 명시하는 일을 함<br/>
awk 프로그램을 작성할 때는 기본적으로
- 패턴: 어떤 값을 추출할 것인지를 명시
  - 패턴이 명시되지 않으면 액션에 명시된 해당 필드값을 모두 출력
- 액션: 추출된 레코드를 전부 출력할 것인지, 특정 필드의 값만 출력할 것인지를 명시

### 2.1. 액션
중괄호 {} 사이에 기술<br/>
&nbsp;- 제어문(조건문, 반복문 등): 쉘 스크립트 기본 문법과 매우 유사함<br/>
&nbsp;- 입/출력문: C언어 문법과 유사함<br/>
|액션|설명|
|--|--|
|print|대상 파일의 내용을 그대로 출력|
|print 필드리스트|대상 파일의 필드 인덱스($0 ~ $n), 자체 변수(NF, FNR 등), 문자열 등을 조합하여 명시한 대로 출력|
|print 필드리스트 > 파일|대상 파일의 필드 인덱스($0 ~ $n), 자체 변수(NF, FNR 등), 문자열 등을 조합하여 명시한 대로 파일에 출력|
|print 포맷, 필드리스트|명시한 대상 파일의 필드 인덱스를 명시한 포맷에 맞추어 출력함|
|print 포맷, 필드리스트 > 파일|명시한 대상 파일의 필드 인덱스를 명시한 포맷에 맞추어 파일에 출력함|
|getline|대상 파일의 짝수 라인과 마지막 라인을 읽어들임|
|getline var|대상 파일의 홀수 라인을 읽어들임
|getline < 파일|명시한 파일의 값을 읽어들임|
|getline var < 파일|명시한 파일의 값을 읽어 var에 저장함
> getline ~~: 단독으로 사용할 수 없으며 print 등과 함께 사용해야 함
### 2.2. 패턴
awk를 이용해 대상 파일에서 어떤 레코드를 출력할 것인지에 대해 명시
|패턴|설명|
|--|--|
|BEGIN { 액션 }<br/>END { 액션 }|입력된 데이터의 첫번째 레코드를 읽기 전에 BEGIN에 의해 선언된 액션을 먼저 처리하며,<br/>END는 모든 작업 완료 후 마지막에 END 액션을 처리함|
|BEGINFILE { 액션 }<br/>ENDFILE { 액션 }|위 패턴과 동일하며, FILENAME이라는 awk 자체 변수를 사용할 경우에는 이 패턴 사용|
|/정규표현식/|패턴을 정규 표현식 형태로 작성할 경우 /여기에/ 표현|
|관계식|필드와 패턴 값을 비교할 경우 산술 연산자를 사용하여 비교|
|( 패턴 )|패턴이나 관계식을 그룹핑하거나 우선순위를 높임|
|패턴1, 패턴2|범위 패턴, 패턴1부터 패턴2 사이에 해당하는 레코드를 출력|

### 2.3. 옵션
일반적으로 사용되는 표준 옵션과 awk 프로그래밍을 위한 확장 옵션으로 이루어짐
#### 2.3.1. 표준 옵션
|옵션|설명|
|--|--|
|-f 파일 / --file 파일|awk 프로그램(패턴 { 액션 })을 파일에 저장하고, 해당 파일을 이용하여 필요한 필드 및 레코드 추출|
|-F 구분기호<br/>--field-separator 구분기호|필드구분 기호를 변경할 수 있음<br/>awk의 기본 필드구분 기호는 공백|
|-v 변수=값<br/>--assign 변수=값|필드 및 레코드를 출력할 때 -v 옵션을 통해 변수의 값을 함께 출력할 수 있음|
#### 2.3.2. 확장 옵션
awk 프로그래밍을 위한 디버그 옵션이나 내장변수 정보, 에러 메시지 등을 표현할 경우 사용되는 옵션들
|옵션|설명|
|--|--|
|-b<br/>--characters-as-bytes|입력되는 문자열을 바이트로 처리하며, 문자열 길이를 구하는 length() 같은 함수의 결과값에 영향을 줌|
|-C<br/>--copyright|GNU 라이센스 정보를 보여줌|
|-d 파일명<br/>--dump-variables=파일명|awk 내장 변수와 값을 명시한 파일에 저장하여 확인할 수 있음|
|-L 'fatal'<br/>--lint='fatal'|구문 오류에 대한 에러 메시지를 자세하게 보여줌|
|-p 파일명<br/>--profile=파일명|awk 프로그램(패턴 {액션})을 awkprog.out 또는 명시한 파일에 파싱하여 저장함|
|-S<br/>--sandbox|system() 함수, getline, 프린트 함수를 이용한 redirection, 확장 모듈 사용을 할 수 없음|
|-V<br/>--version|awk에 대한 버전 정보를 보여줌